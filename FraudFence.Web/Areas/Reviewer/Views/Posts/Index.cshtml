@{
    ViewData["Title"] = "Moderate Posts";
}

<h1 class="h3 mb-4 text-gray-800">Moderate Posts</h1>

<style>
    table th, table td {
        vertical-align: middle;
    }

    .col-post-id {
        width: 70px;
        white-space: nowrap;
    }

    .col-title {
        width: 370px;
        word-break: break-word;
    }

    .col-author {
        width: 200px;
        word-break: break-word;
    }

    .col-date {
        width: 100px;
        white-space: nowrap;
    }

    .col-status {
        width: 100px;
        white-space: nowrap;
    }

    .col-actions {
        width: 300px;
        white-space: nowrap;
    }
</style>

@{
    var statuses = new[] { "", "Pending", "Accepted", "Rejected" };
    var statusLabels = new Dictionary<string, string> { { "", "All" }, { "Pending", "Pending" }, { "Accepted", "Accepted" }, { "Rejected", "Rejected" } };
    var selectedStatus = ViewBag.SelectedStatus as string ?? "";
    var options = new List<string>();
    foreach (var status in statuses)
    {
        var selected = status == selectedStatus ? " selected" : "";
        options.Add($"<option value=\"{status}\"{selected}>{statusLabels[status]}</option>");
    }
}
<!-- Filter Section -->
<div class="mb-3 d-flex justify-content-between align-items-center">
    <form method="get" class="form-inline">
        <label for="statusFilter" class="mr-2 font-weight-bold">Filter by Status:</label>
        <select class="form-control" id="statusFilter" name="status" onchange="this.form.submit()">
            @foreach (var option in options)
            {
                @Html.Raw(option)
            }
        </select>
    </form>
</div>

@functions {
    string GetStatusClass(string status) => status switch
    {
        "Accepted" => "success",
        "Rejected" => "danger",
        "Pending" => "warning",
        _ => "secondary"
    };
}

<table class="table table-striped table-bordered table-show-dt" id="postsTable">
    <thead>
        <tr>
            <th class="col-post-id">Post ID</th>
            <th class="col-title">Title</th>
            <th class="col-author">Author</th>
            <th class="col-date">Date Posted</th>
            <th class="col-status">Status</th>
            <th class="col-actions">Actions</th>
        </tr>
    </thead>
    <tbody>
@foreach (var post in Model)
{
        <tr>
        <td>#POST-@post.Id.ToString("D3")</td>
        <td class="col-title">@post.Content</td>
        <td class="col-author">@post.Author</td>
        <td class="col-date">@post.Date.ToString("yyyy-MM-dd")</td>
        <td class="col-status"><span class="badge badge-@GetStatusClass(post.Status)">@post.Status</span></td>
            <td class="col-actions">
            <a href="@Url.Action("Details", "Posts", new { id = post.Id })" class="btn btn-sm btn-outline-success">
                        <i class="fas fa-eye me-1"></i> View
            </a>
            </td>
        </tr>
}
    </tbody>
</table>

<!-- Modal for viewing and moderating post -->
<div class="modal fade" id="viewPostModal" tabindex="-1" role="dialog" aria-labelledby="viewPostModalLabel" aria-hidden="true">
  <div class="modal-dialog" role="document">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title" id="viewPostModalLabel">Post Details</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <!-- Carousel for images -->
        <div id="modalPostCarousel" class="carousel slide mb-3" data-ride="carousel">
          <div class="carousel-inner" id="modalPostCarouselInner">
            <!-- Images will be injected here by JS -->
          </div>
          <a class="carousel-control-prev" href="#modalPostCarousel" role="button" data-slide="prev">
            <span class="carousel-control-prev-icon" aria-hidden="true"></span>
            <span class="sr-only">Previous</span>
          </a>
          <a class="carousel-control-next" href="#modalPostCarousel" role="button" data-slide="next">
            <span class="carousel-control-next-icon" aria-hidden="true"></span>
            <span class="sr-only">Next</span>
          </a>
        </div>
        <!-- Post content -->
        <div id="modalPostContent" class="mb-3"></div>
        <div class="d-flex justify-content-between align-items-center">
          <div>Posted by <strong id="modalPostAuthor"></strong></div>
          <div><small id="modalPostDate" class="text-muted"></small></div>
        </div>
        <div class="mt-3">
          <strong>Status:</strong>
          <select id="modalPostStatus" class="form-control">
            <option value="1">Pending</option>
            <option value="2">Accepted</option>
            <option value="3">Rejected</option>
          </select>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-dismiss="modal">Close</button>
        <button type="button" class="btn btn-primary" id="savePostStatusBtn">Save</button>
      </div>
    </div>
  </div>
</div>

@section Scripts {
    <script>
        // No DataTable initialization here to avoid reinitialization error
        // Modal logic for populating and saving post status can be added here
    </script>
}
